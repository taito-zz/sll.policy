Introduction
============
This document describes how to upgrade SLL plone site from 2.5.5 to 3.0.6.

Plone-2.5.5
===========

First you need to run ./bin/buildout -v with the 
buildout.cfg and puroducts directory described below.

buildout.cfg::

eggs  = 
    elementtree
    PIL

    Products.PloneFormGen
    Products.PFGExtendedMailAdapter
    Products.PFGSelectionStringField
    Products.PFGVerkkomaksut
    Products.CacheSetup

[versions]
plone.recipe.zope2instance = 3.6
PIL = 1.1.6
Products.PloneFormGen = 1.2.7
Products.PFGExtendedMailAdapter = 0.7.5
Products.PFGSelectionStringField = 0.7.0
Products.PFGVerkkomaksut = 0.9.7

-------------------------------------------

products directory::

    products/
        AnalyticsForPlone
        CMFPayment
        DataGridField
        NewSllSkin
        SimpleCartItem
        ...

-------------------------------------

Run the next commands::

    ./bin/buildout -v
    ./bin/instance fg

* Now go to ZMI and clicking around it.

ZMI >> portal_skins >> custom

    Delete main_template
    Add External method
        id: sci
        Module Name: sci
        Function Name: export_sci
        Save and click Test
            Copy the results to some text file.
            The result will be used on Plone-3.0.6 instance.

ZMI >> portal_skins

    Delete all the newsllskin_* folder.

ZMI >> portal_quickinstaller

    Uninstall
        CacheSetup
        AnalyticsForPlone
        CMFPlacefulWorkflow

ZMI >> portal_quickinstaller >> Contents

    Delete
        ATColorPickerWidget
        ATFlashMovie
        AnalyticsForPlone
        CMFPayment
        CMFPlacefulWorkflow
        CMFSquidTool
        CacheSetup
        Products.CMFSquidTool
        SimpleCartItem
        SllPayment
        eCards

-----------------------------------------

Plone-3.0.6
===========

Get rid of all the products from /products and /productdistros directory.

buildout.cfg::

eggs =
    elementtree
    PIL
    Products.PloneHotfix20110720

    Products.CacheSetup

    sll.policy

    Products.PloneFormGen
    Products.PFGExtendedMailAdapter
    Products.PFGSelectionStringField
    Products.PFGVerkkomaksut

    Products.NewSllSkin

    collective.cart
    pycountry
    collective.pfg.payment

[versions]
plone.recipe.zope2instance = 3.6

PIL = 1.1.6
Products.kupu = 1.4.16

Products.PloneFormGen = 1.2.7
Products.PFGExtendedMailAdapter = 0.7.5
Products.PFGSelectionStringField = 0.7.0
Products.PFGVerkkomaksut = 0.9.7

---------------------------------------------

Then run the next commands::

    ./bin/buildout -v
    ./bin/instance fg

In the new ZMI with Plone-3.0.6:

ZMI >> portal_migration

    Upgrade

Clean right_slots and left_slots from Folders.
You can do it from Properties tab in each folders.
* portlet machenary is different from Plone-2.5.5.

ZMI >> portal_types

    Delte SimpleCartItem
    * We don't use SimpleCartItem in this site any more, but this will be migrated to 
    news item.

ZMI >> portal_quickinstaller

    Install
        sll.policy
    * Do not touch to other part now.

Now go to sll site.

    /sll/kupu_library_tool/kupu_config
        resource type
            From Resource linkable
                Unselect all the PloneFormGen related content types
                    Form Folders, Fieldset Folders, all the fields and adapters.
                    Unselect also:
                        SimpleCartItem
                        Thanks Page

Now go again to ZMI

ZMI >> portal_quickinstaller >> Contents

    Select All and Delete

ZMI >> Control_Panel >> TranslationService

    Select All and Delete

ZMI >> Control_Panel >> Product Management

    Select All and Delete

Restart Zope

In the terminal do CTL-C and ./bin/instance fg

ZMI >> portal_quickinstaller

    Install
        sll.policy
        * This installs all the necessary packages to the site.

ZMI >> portal_catalog >> Advanced

    Clear and Rebuild

ZMI >> Control_Panel >> Database >> main

    Pack
    * Packing reduces size dramatically like 600 M!! :)

On SLL Site

/@@manage-viewlets

    Hide plone.footer
    Change the order if necessary

/kauppa

    Links are all gone, so update links.


Cart Config

    1. Add CartFolder
    2. Site Setup >> Cart Config
        Addable Content Types to Cart
        click update
            * This is necessary even if News Item is already selected here.
            * It takes some time to complete the update.
    3. copy the data you received when you processed export_sci to sci.py file in the next place
        src/sll.policy/sll/policy/Extensions/sci.py
        * You don't need to do this if you haven't updated selling product after this test Data.fs
          The data is there for you.
        * You copy the data to DATA = [...]
    4. ZMI >> portal_skins >> custom
        Add External Method
            id: sci
            Module Name: sll.policy.sci
            Function Name: setting_up_products
            Save and click Test

    Now the news items under the /kauppa folder is products!!
    You can add those to cart!!

